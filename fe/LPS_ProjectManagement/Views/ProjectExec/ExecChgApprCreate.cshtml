@model LPS_ProjectManagement.Models.TransaksiDataModels.ProjectHeaderModel

@{
    ViewBag.Title = "Project Execution : Change Approval";
    Layout = "~/Views/Shared/_Layout.cshtml";
    string[] NeedApproval = Model.NeedApproval.ToString().Split('|');
}

@using (Html.BeginForm(null, null, FormMethod.Post, new { id = "__AjaxAntiForgeryForm" }))
{
    @Html.AntiForgeryToken()
}
@using LPS_ProjectManagement.Helper;

<style type="text/css">

    /*
        loaders
    */


    .spin {
        -webkit-animation: spin 750ms infinite linear;
        -moz-animation: spin 750ms infinite linear;
        animation: spin 750ms infinite linear;
    }

    @@-webkit-keyframes spin {
        to {
            -webkit-transform: rotate(360deg);
        }
    }

    @@-moz-keyframes spin {
        to {
            -moz-transform: rotate(360deg);
        }
    }

    .rspin {
        -webkit-animation: rspin 2250ms infinite linear;
        -moz-animation: rspin 2250ms infinite linear;
        animation: rspin 2250ms infinite linear;
    }

    @@-webkit-keyframes rspin {
        to {
            -webkit-transform: rotate(-360deg);
        }
    }

    @@-moz-keyframes rspin {
        to {
            -moz-transform: rotate(-360deg);
        }
    }
    /* let's style that thing */
    .loader {
        background-color: #eeeeee;
        border-radius: 100%;
        position: relative;
        height: 75px;
        width: 75px;
        overflow: hidden;
    }

        .loader .c {
            position: absolute;
            left: 50%;
            top: 50%;
            margin: -34% 0 0 -34%;
            width: 68%;
            height: 68%;
            background-color: #ffffff;
            border-radius: 100%;
            z-index: 3;
        }

        .loader .d {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
        }

            .loader .d .e {
                position: absolute;
                top: 1%;
                left: 50%;
                margin: 0 0 0 -7.5px;
                height: 14px;
                width: 15px;
                -webkit-transform: rotate(10deg) skew(20deg);
                -moz-transform: rotate(10deg) skew(20deg);
                border-radius: 3px;
                background: #999;
            }

        .loader .r {
            z-index: 2;
            position: absolute;
            left: 50%;
            top: -1px;
            bottom: -1px;
            margin-left: -3.75px;
            background-color: #ffffff;
            width: 7.5px;
        }

        .loader .r1 {
            -webkit-transform: rotate(0deg);
            -moz-transform: rotate(0deg);
        }

        .loader .r2 {
            -webkit-transform: rotate(45deg);
            -moz-transform: rotate(45deg);
        }

        .loader .r3 {
            -webkit-transform: rotate(90deg);
            -moz-transform: rotate(90deg);
        }

        .loader .r4 {
            -webkit-transform: rotate(135deg);
            -moz-transform: rotate(135deg);
        }

    /***/






    .chosen-container-multi .chosen-choices .search-choice {
        background-color: #26C6DA !important;
        border: 0px solid #cccccc !important;
        border-top-right-radius: 0px !important;
        border-top-left-radius: 0px !important;
        border-bottom-right-radius: 0px !important;
        border-bottom-left-radius: 0px !important;
        -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0) !important;
        box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0) !important;
        -ms-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0) !important;
        -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0) !important;
        -o-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0) !important;
        color: #000 !important;
        padding: .7em 2.0em .5em .9em !important;
        font-size: 75% !important;
    }

    .container {
        margin: 150px auto;
    }

    a.button {
        position: relative;
        display: inline-block;
        font-family: tahoma, arial, helvetica;
        font-size: 9pt;
        font-weight: bold;
        color: #ffffff;
        background-color: #AAAAAA;
        padding: 5px;
        text-decoration: none;
        -webkit-border-radius: 5px;
        -moz-border-radius: 5px;
        border-radius: 5px;
    }

    #my-form {
        position: fixed;
        top: 50%;
        left: 50%;
        z-index: 99;
        display: none;
        background-color: white;
        border: 1px solid gray;
        padding: 20px 20px 5px 20px;
        font-family: Tahoma;
        font-size: 10pt;
    }

        #my-form input[type="button"] {
            margin: 10px;
        }
</style>

<style>
    /*
     CSS for the main interaction
    */
    .tabset > input[type="radio"] {
        position: absolute;
        left: -200vw;
    }

    .tabset .tab-panel {
        display: none;
    }

    .tabset > input:first-child:checked ~ .tab-panels > .tab-panel:first-child,
    .tabset > input:nth-child(3):checked ~ .tab-panels > .tab-panel:nth-child(2),
    .tabset > input:nth-child(5):checked ~ .tab-panels > .tab-panel:nth-child(3),
    .tabset > input:nth-child(7):checked ~ .tab-panels > .tab-panel:nth-child(4),
    .tabset > input:nth-child(9):checked ~ .tab-panels > .tab-panel:nth-child(5),
    .tabset > input:nth-child(11):checked ~ .tab-panels > .tab-panel:nth-child(6),
    .tabset > input:nth-child(13):checked ~ .tab-panels > .tab-panel:nth-child(7) {
        display: block;
    }

    /*
     Styling
    */


    .tabset > label {
        position: relative;
        display: inline-block;
        padding: 15px 15px 25px;
        border: 1px solid transparent;
        border-bottom: 0;
        cursor: pointer;
        font-weight: 600;
        font-family: 'Segoe UI';
        background: #d3d3d3;
    }

        .tabset > label::after {
            content: "";
            position: absolute;
            left: 15px;
            bottom: 10px;
            width: 22px;
            height: 4px;
            background: #8d8d8d;
        }

        .tabset > label:hover,
        .tabset > input:focus + label {
            color: white;
            background-color: #dba628;
        }

            .tabset > label:hover::after,
            .tabset > input:focus + label::after,
            .tabset > input:checked + label::after {
                background: white;
            }

    .tabset > input:checked + label {
        border-color: #ccc;
        border-bottom: 1px solid #fff;
        margin-bottom: -1px;
    }

    .tab-panel {
        padding: 30px 0;
        border-top: 1px solid #ccc;
    }
</style>

<style>
    a.buttonu {
        appearance: button;
        text-decoration: none;
        padding: 10px;
        font-size: 12px;
        font-weight: bold;
        background: #5DDBB5;
        border: none;
        border-radius: 4px;
        color: white;
        cursor: pointer;
    }

    .modalu {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background: rgba(0, 0, 0, 0.8);
        z-index: 99999;
        opacity: 0;
        transition: opacity 400ms ease-in;
        pointer-events: none;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
        min-height: 100vh;
    }

    .content-modalu {
        display: flex;
        justify-content: space-between;
        flex-direction: column;
        background: white;
        padding: 30px;
        border-radius: 10px;
        width: 50%;
        height: 60vh;
    }

    .modalu:target {
        opacity: 1;
        pointer-events: auto;
    }

    .modalu h1 {
        font-size: 42px;
    }

    .content-modalu a {
        font-weight: bold;
    }

    .close {
        align-self: flex-end;
        text-decoration: none;
        color: red;
    }
</style>

<style>
    .label-header {
        font-family: 'Segoe UI';
        font-weight: bold;
    }

    .input-header {
        font-family: 'Segoe UI';
    }
</style>

<style>
    .tab-nav {
        list-style: none;
        margin: 0 0 !important;
        padding: 0;
        height: 2.5em;
        overflow: hidden;
    }
</style>

<script>
    var obj = @Html.Raw(Json.Encode(Model));

    (function ($) {
        $.fn.extend({
            donetyping: function (callback, timeout) {
                timeout = timeout || 1e3; // 1 second default timeout
                var timeoutReference,
                    doneTyping = function (el) {
                        if (!timeoutReference) return;
                        timeoutReference = null;
                        callback.call(el);
                    };
                return this.each(function (i, el) {
                    var $el = $(el);

                    $el.is(':input') && $el.on('keyup keypress paste', function (e) {
                        if (e.type === 'keyup' && e.keyCode !== 8) return;

                        if (timeoutReference) clearTimeout(timeoutReference);
                        timeoutReference = setTimeout(function () {
                            doneTyping(el);
                        }, timeout);
                    }).on('blur', function () {
                        doneTyping(el);
                    });
                });
            }
        });
    })(jQuery);

    var ProjectDetail = obj.ProjectDetail;
    var ProjectRisk = obj.ProjectRisk;
    var ListRoleGroup = obj.ProjectModel.ListRoleGroup;
    var ProjectStatus = obj.ProjectStatus;

    var form = $('#__AjaxAntiForgeryForm');
    var token = $('input[name="__RequestVerificationToken"]', form).val();

    var GetDetailKaryawanURl = '@Url.Action("GetDetailEmployeeByPersonNumber", "ManajemenUser")';

    var urlChgApprInsert = '@Url.Action("ExecChgApprInsert", "ProjectExec")';
    var urlChgApprApprove = '@Url.Action("ExecChgApprApprove", "ProjectExec")';
    @*var urlApproveProjectInitiation = '@Url.Action("ApproveProjectInitiation", "ProjectInit")';*@

    var urlProjectExec = '@Url.Action("ExecChgAppr", "ProjectExec")';

    var urlGetDataEmployeeByName = '@Url.Action("GetDataEmployeeByName", "ManajemenUser")';

</script>

<script>

    // -- Table Approval -- \\
    $("#tab-menu").on("click", "li.auto", function (event) {
        if ($(this).hasClass("active") == false) {
            $("#tab-menu>li").removeClass("active");
            $("#tab-menu>li.auto").removeClass("active");
            $("#tab-menu>li>a>span.keyss").removeClass("open");
            $("#tab-menu>li>a>span.keyss").html('keyboard_arrow_right')
            $(this).addClass("active");
            $(this).find("span.keyss").addClass("open");
            $(this).find("span.keyss").html('keyboard_arrow_down')

        } else {
            if ($(event.target).hasClass('childs') == false) {
                $(this).removeClass("active");
                $(this).children().children().removeClass("open");
                $(this).find("span.keyss").html('keyboard_arrow_right')
            }
        }
    });

</script>

<input id="hdf" type="hidden" value="@Session["PersonalNumber"].ToString()" />

<div class="col-md-12 col-lg-12 col-xl-12 col-xs-12">
    <div class="row padding-bottom-15" style="text-align:center;">
        <h3><label>@Model.ProjectModel.ProjectName</label></h3>
    </div>
    <div class="content-body">
        <div class="tab-group">
            <section id="tab3" title="Stakeholder">

                @if (Model.ProjectStatus.StatusName == "ACTIVE")
                {
                    if (NeedApproval[0] == "0")
                    {
                        <div class="row padding-top-15">

                            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">

                                <div class="form-group">
                                    <label class="form-label label-header" for="tblApproval" style="font-weight:bold;">Daftar Jenjang Aproval</label>
                                    <div><br /></div>
                                    <input type="hidden" id="txtUsername" />
                                    <input type="hidden" id="txtJabatan" />
                                    <input type="text" id="txtNamaDisable" placeholder="Nama User" disabled="disabled" />
                                    <a href="#openmodalu" class="buttonu"><i class="fa fa-search"></i>&nbsp; Tambah Stakeholder</a>
                                </div>

                            </div>

                        </div>
                    }
                }
                <div class="row padding-top-0 padding-bottom-0">

                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                        <div class="form-group">
                            <div style="display:none" id="divAddRole">
                                <table id="tblListRole" class="table table-bordered" style="width:100%;">
                                    <thead>
                                        <tr>
                                            <th>Role</th>
                                            <th>Active</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var data in Model.ProjectModel.ListRoleGroup)
                                        {
                                            <tr>
                                                <td>@data.Description</td>
                                                <td>
                                                    <div class="checkbox" style="text-align:center">
                                                        <label class="icheck icheck-success">
                                                            <input id="@data.IDRoleGroup" type="checkbox">
                                                            <i></i>
                                                        </label>
                                                    </div>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                                <a class="buttonu" id="btnAddRole" onclick="AddListTableInitAproval()"><i class="fa fa-plus"></i>&nbsp; Tambah</a>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="row padding-top-0">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <div class="form-group">
                            <div class="controls">
                                <table id="tblApproval" class="display" style="width:100%;">
                                    <thead>
                                        <tr>
                                            <th style="text-align:center" width="3%">No.</th>
                                            <th hidden="hidden">IDRoleGroup</th>
                                            <th hidden="hidden">Username</th>
                                            <th style="text-align:center">Role</th>
                                            <th style="text-align:center">Jabatan</th>
                                            <th style="text-align:center">Nama</th>
                                            <th hidden="hidden">Unit Kerja</th>
                                            <th hidden="hidden">Tanggal Aktif</th>
                                            <th hidden="hidden">Tanggal Berakhir</th>
                                            <th style="text-align:center">Approval</th>
                                            <th style="text-align:center">Actions</th>
                                            <th hidden="hidden">Sequence</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var data in Model.ListProjectInitApprovalRole)
                                        {
                                            if (Model.ProjectStatus.StatusName == "ACTIVE")
                                            {
                                                <tr class="ng-scope">
                                                    <td style="text-align:center">@data.NoUrut</td>
                                                    <td hidden="hidden">@data.IDRoleGroup</td>
                                                    <td hidden="hidden">@data.Username</td>
                                                    <td style="text-align:center">@data.RoleGroupName</td>
                                                    <td style="text-align:center">@data.Jabatan</td>
                                                    <td style="text-align:center">@data.Nama</td>
                                                    <td hidden="hidden">@data.KodeUnitKerja</td>
                                                    <td hidden="hidden">
                                                        <input type="date" class="form-control" id="@data.Username.Replace(".", string.Empty)-txtActiveDate" placeholder="Active Date Approval" value="@data.ActiveDate.ToString("yyyy-MM-dd")">
                                                    </td>
                                                    <td hidden="hidden">
                                                        <input type="date" class="form-control" id="@data.Username.Replace(".", string.Empty)-txtEndDate" placeholder="End Date Approval" value="@data.EndDate.ToString("yyyy-MM-dd")">
                                                    </td>
                                                    <td style="text-align:center">
                                                        <div class="checkbox" style="text-align:center">
                                                            <label class="icheck icheck-success">
                                                                @if (data.IsEnabled == 1)
                                                                {
                                                                    <input id="@data.Username.Replace(".", string.Empty)-@data.IDRoleGroup.ToString()-chbApproval" class="clsEditDelete" type="checkbox" value="" checked="checked">
                                                                }
                                                                else
                                                                {
                                                                    <input id="@data.Username.Replace(".", string.Empty)-@data.IDRoleGroup.ToString()-chbApproval" class="clsEditDelete" type="checkbox" value="">
                                                                }

                                                                <i></i>
                                                            </label>
                                                        </div>
                                                    </td>
                                                    <td style="text-align:center">
                                                        <button title="Naik" type="button" class="btn btn-success btn-xs margin-bottom-5 margin-right-5 clsEditDelete" onclick="up(this)">
                                                            <span class="fa fa-arrow-up"></span>
                                                        </button>
                                                        <button title="Turun" type="button" class="btn btn-warning btn-xs margin-bottom-5 margin-right-5 clsEditDelete" onclick="down(this)">
                                                            <span class="fa fa-arrow-down"></span>
                                                        </button>
                                                        <button title="Hapus" type="button" class="btn btn-danger btn-xs margin-bottom-5 margin-right-5 clsEditDelete" onclick="DeleteListTableApproval(this)">
                                                            <span class="fa fa-trash"></span>
                                                        </button>
                                                    </td>
                                                    <td hidden="hidden">@data.NoUrut</td>
                                                </tr>

                                            }
                                            else
                                            {
                                                <tr class="ng-scope">
                                                    <td style="text-align:center">@data.NoUrut</td>
                                                    <td hidden="hidden">@data.IDRoleGroup</td>
                                                    <td hidden="hidden">@data.Username</td>
                                                    <td style="text-align:center">@data.RoleGroupName</td>
                                                    <td style="text-align:center">@data.Jabatan</td>
                                                    <td style="text-align:center">@data.Nama</td>
                                                    <td hidden="hidden">@data.KodeUnitKerja</td>
                                                    <td hidden="hidden">
                                                        <input type="date" class="form-control" id="@data.Username.Replace(".", string.Empty)-txtActiveDate" placeholder="Active Date Approval" value="@data.ActiveDate.ToString("yyyy-MM-dd")">
                                                    </td>
                                                    <td hidden="hidden">
                                                        <input type="date" class="form-control" id="@data.Username.Replace(".", string.Empty)-txtEndDate" placeholder="End Date Approval" value="@data.EndDate.ToString("yyyy-MM-dd")">
                                                    </td>
                                                    <td style="text-align:center">
                                                        <div class="checkbox" style="text-align:center">
                                                            <label class="icheck icheck-success">
                                                                @if (data.IsEnabled == 1)
                                                                {
                                                                    <input disabled="disabled" id="@data.Username.Replace(".", string.Empty)-@data.IDRoleGroup.ToString()-chbApproval" class="clsEditDelete" type="checkbox" value="" checked="checked">
                                                                }
                                                                else
                                                                {
                                                                    <input disabled="disabled" id="@data.Username.Replace(".", string.Empty)-@data.IDRoleGroup.ToString()-chbApproval" class="clsEditDelete" type="checkbox" value="">
                                                                }

                                                                <i></i>
                                                            </label>
                                                        </div>
                                                    </td>
                                                    <td style="text-align:center">
                                                        @if (data.IsActive == true)
                                                        {
                                                            <span class="fa fa-circle" style="color:forestgreen" title="Approved"></span>
                                                        }
                                                        else if (data.IsEnabled == 0)
                                                        {
                                                            <span class="fa fa-circle" style="color:gray" title="No need approval"></span>
                                                        }
                                                        else
                                                        {
                                                            <span class="fa fa-circle" style="color:red" title="Waiting for approval"></span>
                                                        }
                                                    </td>
                                                    <td hidden="hidden">@data.NoUrut</td>
                                                </tr>
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row padding-top-0">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <button class="btn btn-secondary btn-icon margin-right-15 margin-bottom-15" onclick="location.href='@Url.Action("ExecChgAppr", "ProjectExec")';">
                            <i class="fa fa-link"></i> &nbsp; <span>Back To List</span>
                        </button>

                        @if (NeedApproval[0] == "0")
                        {
                            <button type="button" class="btn btn-accent btn-icon margin-right-15 margin-bottom-15" onclick="ChgApprInsert(@Model.IDProjectHeader, @Model.IDProject)">
                                <i class="fa fa-save"></i> &nbsp; <span>Submit</span>
                            </button>
                        }
                        @if (NeedApproval[0] == "1")
                        {
                            <button type="button" class="btn btn-success btn-icon margin-right-15 margin-bottom-15" onclick="ChgApprRevise(@Model.IDProjectHeader, @Model.IDProject)">
                                <i class="fa fa-arrow-right"></i> &nbsp; <span>Revise</span>
                            </button>
                            <button type="button" class="btn btn-info btn-icon margin-right-15 margin-bottom-15" onclick="ChgApprApprove(@Model.IDProjectHeader, @Model.IDProject)">
                                <i class="fa fa-check"></i> &nbsp; <span>Approve</span>
                            </button>
                        }

                    </div>

                </div>

            </section>
        </div>
    </div>
</div>

<div id="openmodalu" class="modalu">
    <div class="content-modalu" style="height:auto">
        <h1>Tambah User</h1>
        <div class="row">
            <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                <div class="form-group">
                    <label class="form-label" for="field-1" style="font-weight : bold;">Nama User</label>
                    <div class="controls">
                        <input type="text" placeholder="Ketik disini" class="form-control ng-pristine ng-untouched ng-invalid" name="txtFullName" id="txtFullName" required="">
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <table id="tblListUserModal" class="display" style="width:100%">
                    <thead>
                        <tr>
                            <th style="width: 40%">Nama User</th>
                            <th style="width: 40%">Posisi</th>
                            <th style="width: 20%">Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="ListUserBody"></tbody>
                </table>
            </div>
        </div>
        <a href="#close" title="Close" class="close" id="btnClose">CLOSE</a>
    </div>
</div>

<div id="openModalRevise" class="modalu">
    <div class="content-modalu" style="height:auto">
        <h1>Alasan Revisi</h1>
        <div class="row">
            <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                <div class="form-group">
                    <div class="controls">
                        <textarea class="form-control" name="txtReviseForm" id="txtReviseForm" placeholder="reason"></textarea>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                &nbsp;
            </div>
        </div>
        <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-6 col-xs-4">&nbsp;</div>
            <div class="col-lg-2 col-md-2 col-sm-3 col-xs-4">
                <a href="#close" title="Close" class="close" id="btnClose">CLOSE</a>
            </div>
            <div class="col-lg-2 col-md-2 col-sm-3 col-xs-4">
                <a onclick="show_prompt(@Model.IDProjectHeader)" title="Submit" class="close" id="btnSubmit" style="color:green">SUBMIT</a>
            </div>
        </div>
    </div>
</div>

<div id="openmodaluUser" class="modalu">
    <div class="content-modalu" style="height:auto">
        <h1>Tambah Resource</h1>
        <div class="form-group col-md-6">
            <label class="form-label" for="field-1" style="font-weight : bold;">Nama Resource</label>
            <div class="controls">
                <input type="text" placeholder="cari" class="form-control ng-pristine ng-untouched ng-invalid" name="txtFullName1" id="txtFullName1" required="">
            </div>
        </div>
        <table id="tblListUser" class="display" style="width:100%">
            <thead>
                <tr>
                    <th style="width: 40%">Nama User</th>
                    <th style="width: 40%">Posisi</th>
                    <th style="width: 20%">Aksi</th>
                </tr>
            </thead>
            <tbody id="ListUserBody"></tbody>
        </table>

        <a href="#close" title="Close" class="close" id="btnClose">CLOSE</a>
    </div>
</div>

<script>

    function show_prompt(IDProjectHeader) {
        var Reason = $('#txtReviseForm').val();
        ReviseProjectHeader(IDProjectHeader, Reason);
    }

    $(document).ready(function () {

        debugger;
        var model = '@Html.Raw(Json.Encode(NeedApproval[0]))';
        var result = JSON.parse(model);

        if (result == '0') {
            $('.clsEditDelete').removeAttr('disabled');
        }
        else {
            $('.clsEditDelete').attr('disabled', true);
        }


        $(".ll").hide();
        // IFRAME
        iFrameResize({ log: true }, '#gantFrame');

        // -- Tab -- \\
        $('.tab-group').tabify();

        $('.tab-body').tabify();

        $('.tab-risk').tabify();

        // -- HTML Editor -- \\
        $('#txtAnggaranProject').summernote({
            tabsize: 2,
            height: 135,
            toolbar: [
                ['style', ['style']],
                ['font', ['bold', 'italic', 'underline', 'strikethrough', 'superscript', 'subscript', 'clear']],
                ['fontname', ['fontname']],
                ['fontsize', ['fontsize']],
                ['color', ['color']],
                ['para', ['ol', 'ul', 'paragraph', 'height']],
                ['view', ['undo', 'redo']]
            ],
            placeholder: 'Mohon di isi.',
            fontNames: ['Book Antiqua']
        });

        var Anggaran;
        if (ProjectDetail.BudgetDescription === null) {
            var UnitKerja = $('#UnitKerja').val();
            Anggaran = "Anggaran untuk pelaksaan pekerjaan ini sebesar @Model.TotalAnggaran yang berasal dari anggaran " + UnitKerja + " Tahun @DateTime.Now.Year.ToString()";
        } else {
            Anggaran = ProjectDetail.BudgetDescription;
        }

        $('#txtAnggaranProject').summernote(
            'code',
            Anggaran
        );

        $('#txtRuangLingkupProject').summernote({
            tabsize: 2,
            height: 135,
            toolbar: [
                ['style', ['style']],
                ['font', ['bold', 'italic', 'underline', 'strikethrough', 'superscript', 'subscript', 'clear']],
                ['fontname', ['fontname']],
                ['fontsize', ['fontsize']],
                ['color', ['color']],
                ['para', ['ol', 'ul', 'paragraph', 'height']],
                ['view', ['undo', 'redo']]
            ],
            placeholder: 'Mohon di isi.',
            fontNames: ['Book Antiqua']
        });
        //$('#txtRuangLingkupProject').summernote('fontSize', 12);
        $('#txtRuangLingkupProject').summernote(
            'code',
            ProjectDetail.ScopeOfWork
        );

        $('#txtTujuanProject').summernote({
            tabsize: 2,
            height: 135,
            toolbar: [
                ['style', ['style']],
                ['font', ['bold', 'italic', 'underline', 'strikethrough', 'superscript', 'subscript', 'clear']],
                ['fontname', ['fontname']],
                ['fontsize', ['fontsize']],
                ['color', ['color']],
                ['para', ['ol', 'ul', 'paragraph', 'height']],
                ['view', ['undo', 'redo']]
            ],
            placeholder: 'Mohon di isi.',
            fontNames: ['Book Antiqua']
        });
        $('#txtTujuanProject').summernote(
            'code',
            ProjectDetail.Objective
        );

        $('#txtLatarBelakang').summernote({
            tabsize: 2,
            height: 135,
            toolbar: [
                ['style', ['style']],
                ['font', ['bold', 'italic', 'underline', 'strikethrough', 'superscript', 'subscript', 'clear']],
                ['fontname', ['fontname']],
                ['fontsize', ['fontsize']],
                ['color', ['color']],
                ['para', ['ol', 'ul', 'paragraph', 'height']],
                ['view', ['undo', 'redo']]
            ],
            placeholder: 'Mohon di isi.',
            fontNames: ['Book Antiqua']
        });
        $('#txtLatarBelakang').summernote(
            'code',
            ProjectDetail.Background
        );

        $('#txtConstraintProject').summernote({
            tabsize: 2,
            height: 135,
            toolbar: [
                ['style', ['style']],
                ['font', ['bold', 'italic', 'underline', 'strikethrough', 'superscript', 'subscript', 'clear']],
                ['fontname', ['fontname']],
                ['fontsize', ['fontsize']],
                ['color', ['color']],
                ['para', ['ol', 'ul', 'paragraph', 'height']],
                ['view', ['undo', 'redo']]
            ],
            placeholder: 'Mohon di isi.',
            fontNames: ['Book Antiqua']
        });
        $('#txtConstraintProject').summernote(
            'code',
            ProjectRisk.Constraints
        );

        $('#txtAssumptionsProject').summernote({
            tabsize: 2,
            height: 135,
            toolbar: [
                ['style', ['style']],
                ['font', ['bold', 'italic', 'underline', 'strikethrough', 'superscript', 'subscript', 'clear']],
                ['fontname', ['fontname']],
                ['fontsize', ['fontsize']],
                ['color', ['color']],
                ['para', ['ol', 'ul', 'paragraph', 'height']],
                ['view', ['undo', 'redo']]
            ],
            placeholder: 'Mohon di isi.',
            fontNames: ['Book Antiqua']
        });
        $('#txtAssumptionsProject').summernote(
            'code',
            ProjectRisk.Assumptions
        );

        $('#txtRiskProject').summernote({
            tabsize: 2,
            height: 135,
            toolbar: [
                ['style', ['style']],
                ['font', ['bold', 'italic', 'underline', 'strikethrough', 'superscript', 'subscript', 'clear']],
                ['fontname', ['fontname']],
                ['fontsize', ['fontsize']],
                ['color', ['color']],
                ['para', ['ol', 'ul', 'paragraph', 'height']],
                ['view', ['undo', 'redo']]
            ],
            placeholder: 'Mohon di isi.',
            fontNames: ['Book Antiqua']
        });
        $('#txtRiskProject').summernote(
            'code',
            ProjectRisk.Risk
        );

        if (ProjectStatus.StatusName === 'COMPLETED'
            || ProjectStatus.StatusName === 'ACTIVE'
            || ProjectStatus.StatusName === 'SUBMIT'
            || ProjectStatus.StatusName === "CHANGE REQUEST") {
            var NeedApproval = obj.NeedApproval.split("|");
            if (NeedApproval[1] === '1' || NeedApproval[1] === '4') {

            }
            else {
                $('#txtAnggaranProject').summernote('disable');
                $('#txtRuangLingkupProject').summernote('disable');
                $('#txtTujuanProject').summernote('disable');
                $('#txtLatarBelakang').summernote('disable');
                $('#txtConstraintProject').summernote('disable');
                $('#txtAssumptionsProject').summernote('disable');
                $('#txtRiskProject').summernote('disable');
            }
        }

        $('#idTblLogApproval').DataTable({
            "bLengthChange": false,
            searching: false,
            info: false,
            "scrollX": true
        });

        $('#tblApproval').DataTable({
            "bLengthChange": false,
            searching: false,
            info: false,
            "scrollX": true
        });

        $('#tblListUser').DataTable({
            "bLengthChange": false,
            searching: false,
            info: false
        });


        // Dropdownlist
        $("#ddlResources").select2({
            tags: true
        });

        $('#ddlType').on('change', function () {
            if ($('#ddlType').val() == "milestone") {
                $(".ml").css("visibility", "hidden");
            } else {
                $(".ml").css("visibility", "visible");
            }
        });

        $('.ddlDepartment').select2({
            placeholder: 'Pilih Unit Kerja',
            selectOnClose: true
        });

        $('.ddlIsTransformasi').select2({
            placeholder: 'Pilih Transformasi',
            selectOnClose: true
        });

        $('.ddlApproach').select2({
            placeholder: 'Pilih Approach',
            selectOnClose: true
        });


        $("#txtStartDate").flatpickr({
            altInput: true,
            enableTime: true,
            altFormat: "j F Y H:i",
            dateFormat: "d-m-Y H:i"
        });

        $("#txtEndDate").flatpickr({
            altInput: true,
            enableTime: true,
            altFormat: "j F Y H:i",
            dateFormat: "d-m-Y H:i"
        });

    });

    $('#txtFullName').donetyping(function () {
        var GetEmployeeData = {
            ID: $('#txtFullName').val()
        }
        $.ajax({
            url: urlGetDataEmployeeByName,
            type: 'POST',
            data: {
                __RequestVerificationToken: token,
                GetEmployeeData: GetEmployeeData
            },
            success: function (result) {
                $('#tblListUserModal').DataTable().clear();
                $('#tblListUserModal').DataTable().destroy();

                var obj = result._search;
                var html = "";
                for (var prop in obj) {
                    if (obj.hasOwnProperty(prop)) {
                        html += "<tr>" +
                            "<td>" + obj[prop]["nama"] + "</td>" +
                            "<td>" + obj[prop]["posisi"] + "</td>" +
                            "<td>" +
                            "<button type='button' class='btn btn-info btn-corner' id='btnTambah' onclick='SetFieldUser(" + obj[prop]["personalnumber"] + ")'> <i class='fa fa-plus'></i>&nbsp;&nbsp; Pilih</button>" +
                            "</a>" +
                            "</td>" +
                            "</tr>";
                    }
                }
                $("#ListUserBody").append(html);
                $('#tblListUserModal').DataTable({
                    "bLengthChange": false,
                    searching: false,
                    info: false,
                    "pageLength": 4
                });
            }
        });
    });


    function up(element) {

        if ($('#tblApproval tr').length = 0) {
            $('#tblApproval').DataTable().clear();
        }

        $('#tblApproval').DataTable().destroy();

        var tr = $(element).closest('tr');
        var prevtr = $(element).closest('tr').prev('tr');

        var it = element.parentNode.parentNode.rowIndex;
        var prev = it - 1;
        var table = document.getElementById("tblApproval");
        var first = 1;

        if (it != first) {
            table.rows[it].cells[0].innerHTML = prev;
            table.rows[prev].cells[0].innerHTML = it;
            tr.remove();
            tr.insertBefore(prevtr);
        }

        $('#tblApproval').DataTable({
            "bLengthChange": false,
            searching: false,
            info: false,
            "scrollX": true
        });

    }

    function down(element) {

        if ($('#tblApproval tr').length = 0) {
            $('#tblApproval').DataTable().clear();
        }

        $('#tblApproval').DataTable().destroy();

        var tr = $(element).closest('tr');
        var nexttr = $(element).closest('tr').next('tr');

        var it = element.parentNode.parentNode.rowIndex;
        var next = it + 1;
        var table = document.getElementById("tblApproval");
        var last = table.rows.length - 1;

        if (it != last) {
            table.rows[it].cells[0].innerHTML = next;
            table.rows[next].cells[0].innerHTML = it;
            tr.remove();
            tr.insertAfter(nexttr);
        }

        $('#tblApproval').DataTable({
            "bLengthChange": false,
            searching: false,
            info: false,
            "scrollX": true
        });

    }

    function JustifikasiProjectHeader(IDProjectHeader, IDProject) {

        var ProjectDetail = {
            Background: $('#txtLatarBelakang').summernote('code').replace(/</g, "{").replace(/>/g, "}"),
            Objective: $('#txtTujuanProject').summernote('code').replace(/</g, "{").replace(/>/g, "}"),
            ScopeOfWork: $('#txtRuangLingkupProject').summernote('code').replace(/</g, "{").replace(/>/g, "}"),
            BudgetDescription: $('#txtAnggaranProject').summernote('code').replace(/</g, "{").replace(/>/g, "}")
        };

        var ProjectRisk = {
            Constraints: $('#txtConstraintProject').summernote('code').replace(/</g, "{").replace(/>/g, "}"),
            Assumptions: $('#txtAssumptionsProject').summernote('code').replace(/</g, "{").replace(/>/g, "}"),
            Risk: $('#txtRiskProject').summernote('code').replace(/</g, "{").replace(/>/g, "}"),
            Approach: $('#ddlApproach').val()//$('#txtApproachProject').summernote('code').replace(/</g, "{").replace(/>/g, "}")
        };

        var tableApproval = $('#tblApproval').DataTable();
        var dataApproval = tableApproval.rows().data();
        var ListProjectInitApprovalRole = [];
        var ListProjectRoleGroup = [];

        for (i = 0; i < dataApproval.length; i++) {
            var rowsApproval = dataApproval[i];
            var IsEnabled = 0;
            if ($('#' + rowsApproval[2].replace(/\./g, "") + '-' + String(rowsApproval[1]) + '-chbApproval').is(":checked")) {
                var IsEnabled = 1;
            }

            ListProjectInitApprovalRole.push({
                Sequence: rowsApproval[0],
                IDRoleGroup: rowsApproval[1],
                Username: rowsApproval[2],
                ActiveDate: $('#' + rowsApproval[2].replace(/\./g, "") + '-txtActiveDate').val(),
                EndDate: $('#' + rowsApproval[2].replace(/\./g, "") + '-txtEndDate').val(),
                IsEnabled: IsEnabled
            });
            debugger;
            var str = rowsApproval[1];
            var array = str.split("|");

            for (j = 0; j < array.length; j++) {
                ListProjectRoleGroup.push({
                    IDProjectRoleGroup: array[j],
                    Username: rowsApproval[2]
                });
            }

        }

        //var StartYear = $('#ddlStartYear').val();
        //var EndYear = $('#ddlEndYear').val();
        //var StartMonth = $('#ddlStartMonth').val();
        //var EndMonth = $('#ddlEndMonth').val();

        var ProjectHeader = {
            IDProjectHeader: IDProjectHeader,
            IDProject: IDProject,
            Sequence: 0,
            IDProjectStatus: 1,
            StartYear: $('#ddlStartYear').val(),
            StartMonth: $('#ddlStartMonth').val(),
            EndYear: $('#ddlEndYear').val(),
            EndMonth: $('#ddlEndMonth').val(),
            //NoKontrak: $('#txtNoContract').val(),
            //ContractStartDate: $('#txtContractStartDate').val(),
            //ContractEndDate: $('#txtContractEndDate').val(),
            //ContractIDR: $('#txtContractIDR').val(),
            //ContractUSD: $('#txtContractUSD').val(),
            //WeightKPI: $('#txtProjWeight').val(),
            CreatedBy: $('#hdf').val(),
            TypeTransaction: "Justifikasi",
            ProjectDetail: ProjectDetail,
            ProjectRisk: ProjectRisk,
            //ListProjectConstraint: $("#tblConstraint").FullTable("getData"),
            //ListProjectHeaderCost: ListProjectHeaderCost,
            ListProjectInitApprovalRole: ListProjectInitApprovalRole,
            ListProjectRoleGroup: ListProjectRoleGroup
        };

        $.ajax({
            type: "POST",
            url: urlInsertProjectInitiation,
            data: ProjectHeader,
            success: function (result) {
                if (result.Result === "Success") {
                    debugger;
                    savefromezero();

                    alert(result.Message);
                }
                else {
                    alert(result.Message);
                }
            }
        });

        //var d1 = new Date('1/' + StartMonth + '/' + StartYear).getTime();
        //var d2 = new Date('1/' + EndMonth + '/' + EndYear).getTime();

        //if (d2 >= d1) {

        //}
        //else {
        //    alert("Bulan dan tahun selesai harus setelah atau sama dengan bulan dan tahun mulai");
        //}

    }

    function ChgApprInsert(IDProjectHeader, IDProject) {

        var tableApproval = $('#tblApproval').DataTable();
        var dataApproval = tableApproval.rows().data();
        var ListProjectInitApprovalRole = [];
        var ListProjectRoleGroup = [];

        for (i = 0; i < dataApproval.length; i++) {
            var rowsApproval = dataApproval[i];
            debugger;
            var IsEnabled = 0;
            var test = rowsApproval[2].replace(/\./g, "");
            if ($('#' + rowsApproval[2].replace(/\./g, "") + '-' + String(rowsApproval[1]) + '-chbApproval').is(":checked")) {
                var IsEnabled = 1;
            }

            ListProjectInitApprovalRole.push({
                Sequence: rowsApproval[0],
                IDRoleGroup: rowsApproval[1],
                Username: rowsApproval[2],
                ActiveDate: $('#' + rowsApproval[2].replace(/\./g, "") + '-txtActiveDate').val(),
                EndDate: $('#' + rowsApproval[2].replace(/\./g, "") + '-txtEndDate').val(),
                IsEnabled: IsEnabled
            });
            debugger;
            var str = rowsApproval[1];
            var array = str.split("|");

            for (j = 0; j < array.length; j++) {
                ListProjectRoleGroup.push({
                    IDProjectRoleGroup: array[j],
                    Username: rowsApproval[2]
                });
            }
        }


        var ProjectHeader = {
            IDProjectHeader: IDProjectHeader,
            IDProject: IDProject,
            Sequence: 0,
            IDProjectStatus: 1,
            CreatedBy: $('#hdf').val(),
            TypeTransaction: "Save",
            ListProjectInitApprovalRole: ListProjectInitApprovalRole,
            ListProjectRoleGroup: ListProjectRoleGroup
        };

        var r = confirm("Project akan di simpan ?");

        if (r == true) {

            $.ajax({
                type: "POST",
                url: urlChgApprInsert,
                data: ProjectHeader,
                success: function (result) {
                    if (result.Result === "Success") {
                        debugger;

                        alert(result.Message);
                        window.location.href = urlProjectExec;
                    }
                    else {
                        alert(result.Message);
                        window.location.href = urlProjectExec;
                    }
                }
            });
        }
    }
    function ChgApprRevise(IDProjectHeader, IDProject) {

        var tableApproval = $('#tblApproval').DataTable();
        var dataApproval = tableApproval.rows().data();
        var ListProjectInitApprovalRole = [];
        var ListProjectRoleGroup = [];

        for (i = 0; i < dataApproval.length; i++) {
            var rowsApproval = dataApproval[i];
            debugger;
            var IsEnabled = 0;
            var test = rowsApproval[2].replace(/\./g, "");
            if ($('#' + rowsApproval[2].replace(/\./g, "") + '-' + String(rowsApproval[1]) + '-chbApproval').is(":checked")) {
                var IsEnabled = 1;
            }

            ListProjectInitApprovalRole.push({
                Sequence: rowsApproval[0],
                IDRoleGroup: rowsApproval[1],
                Username: rowsApproval[2],
                ActiveDate: $('#' + rowsApproval[2].replace(/\./g, "") + '-txtActiveDate').val(),
                EndDate: $('#' + rowsApproval[2].replace(/\./g, "") + '-txtEndDate').val(),
                IsEnabled: IsEnabled
            });
            debugger;
            var str = rowsApproval[1];
            var array = str.split("|");

            for (j = 0; j < array.length; j++) {
                ListProjectRoleGroup.push({
                    IDProjectRoleGroup: array[j],
                    Username: rowsApproval[2]
                });
            }
        }


        var ProjectHeader = {
            IDProjectHeader: IDProjectHeader,
            IDProject: IDProject,
            Sequence: 0,
            IDProjectStatus: 1,
            CreatedBy: $('#hdf').val(),
            TypeTransaction: "Revise",
            ListProjectInitApprovalRole: ListProjectInitApprovalRole,
            ListProjectRoleGroup: ListProjectRoleGroup
        };

        var r = confirm("Project akan di Revise ?");

        if (r == true) {

            $.ajax({
                type: "POST",
                url: urlChgApprInsert,
                data: ProjectHeader,
                success: function (result) {
                    if (result.Result === "Success") {
                        debugger;

                        alert(result.Message);
                        window.location.href = urlProjectExec;
                    }
                    else {
                        alert(result.Message);
                        window.location.href = urlProjectExec;
                    }
                }
            });
        }else {
            window.location.href = urlProjectExec;
        }
    }
    function ChgApprApprove(IDProjectHeader, IDProject) {

        var tableApproval = $('#tblApproval').DataTable();
        var dataApproval = tableApproval.rows().data();
        var ListProjectInitApprovalRole = [];
        var ListProjectRoleGroup = [];

        for (i = 0; i < dataApproval.length; i++) {
            var rowsApproval = dataApproval[i];
            debugger;
            var IsEnabled = 0;
            var test = rowsApproval[2].replace(/\./g, "");
            if ($('#' + rowsApproval[2].replace(/\./g, "") + '-' + String(rowsApproval[1]) + '-chbApproval').is(":checked")) {
                var IsEnabled = 1;
            }

            ListProjectInitApprovalRole.push({
                Sequence: rowsApproval[0],
                IDRoleGroup: rowsApproval[1],
                Username: rowsApproval[2],
                ActiveDate: $('#' + rowsApproval[2].replace(/\./g, "") + '-txtActiveDate').val(),
                EndDate: $('#' + rowsApproval[2].replace(/\./g, "") + '-txtEndDate').val(),
                IsEnabled: IsEnabled
            });
            debugger;
            var str = rowsApproval[1];
            var array = str.split("|");

            for (j = 0; j < array.length; j++) {
                ListProjectRoleGroup.push({
                    IDProjectRoleGroup: array[j],
                    Username: rowsApproval[2]
                });
            }
        }


        var ProjectHeader = {
            IDProjectHeader: IDProjectHeader,
            IDProject: IDProject,
            Sequence: 0,
            IDProjectStatus: 1,
            CreatedBy: $('#hdf').val(),
            TypeTransaction: "Approve",
            ListProjectInitApprovalRole: ListProjectInitApprovalRole,
            ListProjectRoleGroup: ListProjectRoleGroup
        };

        var r = confirm("Project akan di Aprove ?");

        if (r == true) {

            $.ajax({
                type: "POST",
                url: urlChgApprInsert,
                data: ProjectHeader,
                success: function (result) {
                    if (result.Result === "Success") {
                        debugger;

                        alert(result.Message);
                        window.location.href = urlProjectExec;
                    }
                    else {
                        alert(result.Message);
                        window.location.href = urlProjectExec;
                    }
                }
            });
        } else {
            window.location.href = urlProjectExec;
        }
    }


    function SubmitProjectHeader(IDProjectHeader, IDProject) {

        var ProjectDetail = {
            Background: $('#txtLatarBelakang').summernote('code').replace(/</g, "{").replace(/>/g, "}"),
            Objective: $('#txtTujuanProject').summernote('code').replace(/</g, "{").replace(/>/g, "}"),
            ScopeOfWork: $('#txtRuangLingkupProject').summernote('code').replace(/</g, "{").replace(/>/g, "}"),
            BudgetDescription: $('#txtAnggaranProject').summernote('code').replace(/</g, "{").replace(/>/g, "}")
        };

        var ProjectRisk = {
            Constraints: $('#txtConstraintProject').summernote('code').replace(/</g, "{").replace(/>/g, "}"),
            Assumptions: $('#txtAssumptionsProject').summernote('code').replace(/</g, "{").replace(/>/g, "}"),
            Risk: $('#txtRiskProject').summernote('code').replace(/</g, "{").replace(/>/g, "}"),
            Approach: $('#ddlApproach').val()//$('#txtApproachProject').summernote('code').replace(/</g, "{").replace(/>/g, "}")
        };

        //var myTabCost = $('#tblProjectCost').DataTable();
        //var dataCost = myTabCost.rows().data();
        //var ListProjectHeaderCost = [];

        //for (i = 0; i < dataCost.length; i++) {
        //    var rowsCost = dataCost[i];
        //    ListProjectHeaderCost.push({ IDProjectCost: rowsCost[2], Value: rowsCost[3] });
        //}

        var tableApproval = $('#tblApproval').DataTable();
        var dataApproval = tableApproval.rows().data();
        var ListProjectInitApprovalRole = [];
        var ListProjectRoleGroup = [];

        var RoleProjectAdmin = 0;
        var RoleProjectManager = 0;
        var RoleProgramManager = 0;
        var RoleHeadOfPMO = 0;
        var IsEnabled = 0;
        var IsApprove = 0;

        for (i = 0; i < dataApproval.length; i++) {

            var rowsApproval = dataApproval[i];
            IsEnabled = 0;

            if ($('#' + rowsApproval[2].replace(/\./g, "") + '-' + String(rowsApproval[1]) + '-chbApproval').is(":checked")) {
                IsEnabled = 1;
                IsApprove = 1;
            }
            if (rowsApproval[1] === "2") {
                RoleProjectAdmin = 1;
            }
            if (rowsApproval[1] === "3") {
                RoleProjectManager = 1;
            }
            if (rowsApproval[1] === "5") {
                RoleProgramManager = 1
            }
            if (rowsApproval[1] === "6") {
                RoleHeadOfPMO = 1
            }

            ListProjectInitApprovalRole.push({
                Sequence: rowsApproval[0],
                IDRoleGroup: rowsApproval[1],
                Username: rowsApproval[2],
                ActiveDate: $('#' + rowsApproval[2].replace(/\./g, "") + '-txtActiveDate').val(),
                EndDate: $('#' + rowsApproval[2].replace(/\./g, "") + '-txtEndDate').val(),
                IsEnabled: IsEnabled
            });

            var str = rowsApproval[1];
            var array = str.split("|");

            for (j = 0; j < array.length; j++) {
                ListProjectRoleGroup.push({
                    IDProjectRoleGroup: array[j],
                    Username: rowsApproval[2]
                });
            }

        }

        //var StartYear = $('#ddlStartYear').val();
        //var EndYear = $('#ddlEndYear').val();
        //var StartMonth = $('#ddlStartMonth').val();
        //var EndMonth = $('#ddlEndMonth').val();

        var ProjectHeader = {
            IDProjectHeader: IDProjectHeader,
            IDProject: IDProject,
            Sequence: 1,
            IDProjectStatus: 2,
            //StartYear: $('#ddlStartYear').val(),
            //StartMonth: $('#ddlStartMonth').val(),
            //EndYear: $('#ddlEndYear').val(),
            //EndMonth: $('#ddlEndMonth').val(),
            //NoKontrak: $('#txtNoContract').val(),
            //ContractStartDate: $('#txtContractStartDate').val(),
            //ContractEndDate: $('#txtContractEndDate').val(),
            //ContractIDR: $('#txtContractIDR').val(),
            //ContractUSD: $('#txtContractUSD').val(),
            //WeightKPI: $('#txtProjWeight').val(),
            CreatedBy: $('#hdf').val(),
            TypeTransaction: "Submit",
            ProjectDetail: ProjectDetail,
            ProjectRisk: ProjectRisk,
            //ListProjectConstraint: $("#tblConstraint").FullTable("getData"),
            //ListProjectHeaderCost: ListProjectHeaderCost,
            ListProjectInitApprovalRole: ListProjectInitApprovalRole,
            ListProjectRoleGroup: ListProjectRoleGroup
        };

        var r = confirm("Anda yakin ingin mensubmit project ini ?");

        if (r == true) {

            if (dataApproval.length > 0) {

                if (RoleProjectAdmin == 0) alert("Tentukan Project Admin terlebih dahulu")
                else if (RoleProjectManager == 0) alert("Tentukan Project Manager terlebih dahulu")
                else if (RoleProgramManager == 0) alert("Tentukan Program Manager terlebih dahulu")
                else if (RoleHeadOfPMO == 0) alert("Tentukan Head Of PMO terlebih dahulu")
                else if (IsApprove == 0) alert("Ceklist approval terlebih dahulu")
                else {
                    var json = document.getElementById('gantFrame').contentWindow.getGanttData();

                    if (json.data.length > 0) {

                        $.ajax({
                            type: "POST",
                            url: urlInsertProjectInitiation,
                            data: ProjectHeader,
                            success: function (result) {
                                if (result.Result === "Success") {
                                    savefromezero();
                                    alert(result.Message);
                                    //GetDataIFExistSubmit();
                                    window.location.href = urlProjectInitiation;
                                }
                                else {
                                    alert(result.Message);
                                }
                            }
                        });

                    }
                    else {
                        alert("File MPP belum di upload");
                    }
                }

            }
            else {

                alert("Masukan daftar approval terlebih dahulu");

            }

            //var d1 = new Date('1/' + StartMonth + '/' + StartYear).getTime();
            //var d2 = new Date('1/' + EndMonth + '/' + EndYear).getTime();

            //if (d2 >= d1) {

            //}
            //else {
            //    alert("Bulan dan tahun selesai harus setelah bulan dan tahun mulai");
            //}

        }
    }

    function ReviseProjectHeader(IDProjectHeader, Deskripsi) {

        var ProjectHeader = {
            IDProjectHeader: IDProjectHeader,
            ApprovedBy: Deskripsi,
            CreatedBy: $('#hdf').val(),
            TypeTransaction: 'Revise'
        };

        var r = confirm("Anda yakin ingin Revise project ini ?");
        if (r == true) {
            $.ajax({
                type: "POST",
                url: urlChgApprApprove,
                data: ProjectHeader,
                success: function (result) {
                    if (result.Result === "Success") {
                        alert(result.Message);
                        //GetDataIFExistSubmit();
                        window.location.href = urlProjectExec;
                    }
                    else {
                        alert(result.Message);
                    }
                }
            });
        }
    }

    function CopyProjectHeader(IDProjectHeader, IDProject) {

        var r = confirm("Project ini akan di copy ?");

        if (r == true) {
            var ProjectDetail = {
                Background: $('#txtLatarBelakang').summernote('code').replace(/</g, "{").replace(/>/g, "}"),
                Objective: $('#txtTujuanProject').summernote('code').replace(/</g, "{").replace(/>/g, "}"),
                ScopeOfWork: $('#txtRuangLingkupProject').summernote('code').replace(/</g, "{").replace(/>/g, "}"),
                BudgetDescription: $('#txtAnggaranProject').summernote('code').replace(/</g, "{").replace(/>/g, "}")
            };

            var ProjectRisk = {
                Constraints: $('#txtConstraintProject').summernote('code').replace(/</g, "{").replace(/>/g, "}"),
                Assumptions: $('#txtAssumptionsProject').summernote('code').replace(/</g, "{").replace(/>/g, "}"),
                Risk: $('#txtRiskProject').summernote('code').replace(/</g, "{").replace(/>/g, "}"),
                Approach: $('#ddlApproach').val()//$('#txtApproachProject').summernote('code').replace(/</g, "{").replace(/>/g, "}")
            };

            var ProjectHeader = {
                IDProjectHeader: IDProjectHeader,
                IDProject: IDProject,
                Sequence: 0,
                IDProjectStatus: 1,
                //StartYear: $('#ddlStartYear').val(),
                //StartMonth: $('#ddlStartMonth').val(),
                //EndYear: $('#ddlEndYear').val(),
                //EndMonth: $('#ddlEndMonth').val(),
                //NoKontrak: $('#txtNoContract').val(),
                //ContractStartDate: $('#txtContractStartDate').val(),
                //ContractEndDate: $('#txtContractEndDate').val(),
                //ContractIDR: $('#txtContractIDR').val(),
                //ContractUSD: $('#txtContractUSD').val(),
                //WeightKPI: $('#txtProjWeight').val(),
                CreatedBy: $('#hdf').val(),
                TypeTransaction: "Copy",
                ProjectDetail: ProjectDetail,
                ProjectRisk: ProjectRisk
                //ListProjectConstraint: $("#tblConstraint").FullTable("getData"),
                //ListProjectHeaderCost: ListProjectHeaderCost,
                //ListProjectInitApprovalRole: ListProjectInitApprovalRole,
                //ListProjectRoleGroup: ListProjectRoleGroup
            };

            $.ajax({
                type: "POST",
                url: urlInsertProjectInitiation,
                data: ProjectHeader,
                success: function (result) {
                    if (result.Result === "Success") {
                        debugger;
                        alert(result.Message);
                        //InsertMPP();
                        window.location.href = urlProjectInitiation;
                    }
                    else {
                        debugger;
                        alert(result.Message);
                    }
                }
            });
        }

    }


    function AddListTableCost() {

        var ddlProjectCost = document.getElementById("ddlProjectCost");
        var IDProjectCost = ddlProjectCost.options[ddlProjectCost.selectedIndex].value;

        var ProjectCost = {
            IDProjectCost: IDProjectCost
        }

        $.ajax({
            url: urlMasterProyekCostByID,
            type: 'POST',
            data: ProjectCost,
            success: function (result) {
                if ($('#tblProjectCost tr').length = 0) {
                    $('#tblProjectCost').DataTable().clear();
                }
                $('#tblProjectCost').DataTable().destroy();

                $('#tblProjectCost tbody').append('<tr><td>' + result.ProjectCost.ProjectCostName + '</td><td>' + result.ProjectCost.ProjectCostCode + '</td><td style = "display:none">' + result.ProjectCost.IDProjectCost + '</td><td>' + $('#txtValueProjectCost').val() + '</td><td><a onclick="DeleteListTableCost(this)" class="btn btn-danger tooltipcustom margin-top-5 margin-bottom-5"><i class= "fa fa-trash" ></i><span class="tooltiptext"> Hapus</span></a></td></tr>');

                $('#tblProjectCost').DataTable({
                    "bLengthChange": false,
                    searching: false,
                    info: false,
                    "scrollX": true
                });

                $('#txtValueProjectCost').val("");
            }
        });
    }

    function AddListTableInitAproval() {

        var tblApproval = $('#tblApproval').DataTable();
        var dataTblApproval = tblApproval.rows().data();
        var cekUsername = '';
        var cekRole = '';
        var RoleAvailable = 0;

        debugger;

        if ($('#tblApproval tr').length = 0) {
            $('#tblApproval').DataTable().clear();
        }

        $('#tblApproval').DataTable().destroy();

        document.getElementById("divAddRole").style.display = "none";

        var objLRG = ListRoleGroup;
        var Nama = $("#txtNamaDisable").val();
        var Username = $("#txtUsername").val();
        var Jabatan = $("#txtJabatan").val();

        for (x = 0; x < objLRG.length; x++) {
            var idcb = '#' + objLRG[x].IDRoleGroup;
            if ($(idcb).is(":checked")) {

                RoleAvailable = 0;

                for (y = 0; y < dataTblApproval.length; y++) {

                    cekUsername = dataTblApproval[y][2];
                    cekRole = dataTblApproval[y][1];

                    if (cekRole == objLRG[x].IDRoleGroup && cekUsername == Username) {
                        alert(Nama + ' dengan role ' + objLRG[x].Description + ' sudah tersedia');
                        RoleAvailable = 1;
                    }
                }

                if (RoleAvailable == 0) {
                    var table = document.getElementById("tblApproval");
                    var last = table.rows.length;
                    debugger;
                    $('#tblApproval tbody').append(
                        '<tr class="ng-scope"><td style="text-align:center">' + last +
                        '</td><td hidden="hidden">' + objLRG[x].IDRoleGroup +
                        '</td><td hidden="hidden">' + Username +
                        '</td><td style="text-align:center">' + objLRG[x].Description +
                        '</td><td style="text-align:center">' + Jabatan +
                        '</td><td style="text-align:center">' + Nama +
                        '</td><td hidden="hidden">-</td>' +
                        '<td hidden="hidden"><input type="date" class="form-control" id="' + Username.replace(/\./g, "") +
                        '-txtActiveDate" placeholder="Active Date Approval"></td><td hidden="hidden"><input type="date" class="form-control" id="' + Username.replace(/\./g, "") + '-' + objLRG[x].IDRoleGroup +
                        '-txtEndDate" placeholder="End Date Approval"></td><td style="text-align:center"><div class="checkbox" style="text-align:center"><label class="icheck icheck-success"><input id="' + Username.replace(/\./g, "") + '-' + objLRG[x].IDRoleGroup +
                        '-chbApproval" type="checkbox" value="" checked=""><i></i></label></div></td>' +
                        '<td style="text-align:center"><button title="Naik" type="button" class="btn btn-success btn-xs margin-bottom-5 margin-right-5" onclick="up(this)"><span class="fa fa-arrow-up"></span></button><button title="Turun" type="button" class="btn btn-warning btn-xs margin-bottom-5 margin-right-5" onclick="down(this)"><span class="fa fa-arrow-down"></span></button><button title="Hapus" type="button" class="btn btn-danger btn-xs margin-bottom-5 margin-right-5" onclick="DeleteListTableApproval(this)"><span class="fa fa-trash"></span></button></td>' +
                        '<td hidden="hidden">' + last + '</td></tr>');

                    $(idcb).prop("checked", false);
                }

            }
        }

        $('#tblApproval').DataTable({
            "bLengthChange": false,
            searching: false,
            info: false,
            "scrollX": true
        });

        $("#txtNamaDisable").val("");
        $('#txtFullName').val("");

    }


    function DeleteListTableCost(element) {

        var r = confirm("Anda yakin ingin menghapus Cost ini ?");

        if (r == true) {

            if ($('#tblProjectCost tr').length = 0) {
                $('#tblProjectCost').DataTable().clear();
            }

            $('#tblProjectCost').DataTable().destroy();

            document.getElementById("tblProjectCost").deleteRow(element.parentNode.parentNode.rowIndex);

            $('#tblProjectCost').DataTable({
                "bLengthChange": false,
                searching: false,
                info: false,
                "scrollX": true
            });

        }

    }

    function DeleteListTableApproval(element) {

        if ($('#tblApproval tr').length = 0) {
            $('#tblApproval').DataTable().clear();
        }

        $('#tblApproval').DataTable().destroy();

        var r = confirm("Anda yakin ingin menghapus User ini ?");

        if (r == true) {

            var it = element.parentNode.parentNode.rowIndex;

            document.getElementById("tblApproval").deleteRow(it);

            var table = document.getElementById("tblApproval");
            var last = table.rows.length - 1;

            for (var x = it; x <= last; x++) {
                table.rows[x].cells[0].innerHTML = x;
            }

        }

        $('#tblApproval').DataTable({
            "bLengthChange": false,
            searching: false,
            info: false,
            "scrollX": true
        });

    }


    function BindFieldCost(IDProjectCost) {

        var ProjectCost = {
            IDProjectCost: IDProjectCost
        }

        $.ajax({
            url: urlMasterProyekCostByID,
            type: 'POST',
            data: ProjectCost,
            success: function (result) {
                document.getElementById("txtNameCost").value = result.ProjectCost.ProjectCostName;
                document.getElementById("txtKodeCost").value = result.ProjectCost.ProjectCostCode;
                document.getElementById("txtIDProjectCost").value = result.ProjectCost.IDProjectCost;
            }
        });

    }

    function approvalInit() {

        if ($('#tblApproval tr').length = 0) {
            $('#tblApproval').DataTable().clear();
        }

        $('#tblApproval').DataTable().destroy();

        $('#tblApproval').DataTable({
            "bLengthChange": false,
            searching: false,
            info: false,
            "scrollX": true
        });

    }

    function tabFormulir() {

        if ($('#tblKPI tr').length = 0) {
            $('#tblKPI').DataTable().clear();
        }

        $('#tblKPI').DataTable().destroy();

        $('#tblKPI').DataTable({
            "bLengthChange": false,
            searching: false,
            info: false,
            "scrollX": true
        });



        if ($('#tblRKAT tr').length = 0) {
            $('#tblRKAT').DataTable().clear();
        }

        $('#tblRKAT').DataTable().destroy();

        $('#tblRKAT').DataTable({
            "bLengthChange": false,
            searching: false,
            info: false,
            "scrollX": true
        });
    }

    function GetToday() {
        var today = new Date();
        var dd = today.getDate();
        var mm = today.getMonth() + 1; //January is 0!
        var yyyy = today.getFullYear();

        if (dd < 10) {
            dd = '0' + dd;
        }

        if (mm < 10) {
            mm = '0' + mm;
        }

        today = mm + '/' + dd + '/' + yyyy;

        return today;
    }

    function ValidMonth() {
        var StartYear = $('#ddlStartYear').val();
        var EndYear = $('#ddlEndYear').val();
        var StartMonth = $('#ddlStartMonth').val();
        var EndMonth = $('#ddlEndMonth').val();

        var d1 = new Date('1/' + StartMonth + '/' + StartYear).getTime();
        var d2 = new Date('1/' + EndMonth + '/' + EndYear).getTime();

        if (d2 < d1) {
            alert("Bulan dan tahun selesai harus setelah bulan dan tahun mulai");
            $('#ddlEndMonth').val(StartMonth).change();
        }
    }

    function ValidYear() {
        var StartYear = $('#ddlStartYear').val();
        var EndYear = $('#ddlEndYear').val();
        var StartMonth = $('#ddlStartMonth').val();
        var EndMonth = $('#ddlEndMonth').val();

        var d1 = new Date('1/' + StartMonth + '/' + StartYear).getTime();
        var d2 = new Date('1/' + EndMonth + '/' + EndYear).getTime();

        if (d2 < d1) {
            alert("Bulan dan tahun selesai harus setelah bulan dan tahun mulai");
            $('#ddlEndYear').val(StartYear).change();
        }
    }

</script>

<script src="~/Scripts/Views/Proyek/ProjectInitiationCreate.js"></script>